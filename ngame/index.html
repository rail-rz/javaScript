<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Персональная страница Замалетдинова Раиля</title>
    <style>
        html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre,
        a, abbr, acronym, address, big, cite, code, del, dfn, em, font, img, ins, kbd, q, s, samp,
        small, strike, strong, sub, sup, tt, var, dl, dt, dd, ol, ul, li,
        fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td
        { margin:0; padding:0; border:0; outline:0;
            font-weight:inherit; font-style:inherit; font-size:100%; font-family:inherit;
            vertical-align:baseline; }
    </style>
    <script>
        function Init() {
            var canvas = document.getElementById('namga-game');
            var context = canvas.getContext("2d");
            var canvasParam = { color:'grey', x:0, y:0, realWidth:640, realHeight:480 }
            // задаем размеры и разрешение canvas
            canvas.style.width = canvasParam.realWidth + 'px';
            canvas.style.height = canvasParam.realHeight + 'px';
            canvas.width = canvasParam.realWidth;
            canvas.height = canvasParam.realHeight;

            // TODO: GLOBAL? It`s not Global
            gameCanvas = new Rect( context, canvasParam);
            var playerParams = { path:'image/nlo.png', x:0, y:0, imageWidth:300, imageHeight:300, realWidth:100, realHeight:100, frameX:3, frameY:2, currentFrameX:0, currentFrameY:0}
            player = new AnimatePerson( context, playerParams);
            var element1Params = {color:'red', x:200, y:200, realWidth:100, realHeight:100}
            element1 = new Rect(context, element1Params);

//            canvas.onmousemove = mouseMove;
            window.addEventListener( "keydown", doKeyDown, false);

            setInterval(PlayGame, 1000 / 50);
        }

        // создаем класс Rect для отрисовки прямоугольников
        function Rect( context, params) {
            this.color = params.color;	// цвет прямоугольника
            this.x = params.x; // координата х
            this.y = params.y; // координата у
            this.width = params.realWidth; // ширина
            this.height = params.realHeight; // высота
            // Метод рисующий прямоугольник
            this.drawing = function () {
                context.fillStyle = this.color;
                context.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        // создание анимированных спрайтов
        function AnimatePerson(context, params) {
            this.x = params.x; // координата х
            this.y = params.y; // координата у
            this.width = params.realWidth; // ширина
            this.height = params.realHeight; // высота

            image = new Image();
            image.src = params.path;

            this.drawing = function(){
                context.drawImage(image, params.imageWidth * params.currentFrameX, params.imageHeight*params.currentFrameY , params.imageWidth, params.imageHeight, this.x, this.y, params.realWidth, params.realHeight);

                if (params.currentFrameX == params.frameX) {
                    params.currentFrameX = 0;
                    if(params.currentFrameY == params.frameY) {
                        params.currentFrameY =0;
                    } else {
                        params.currentFrameY ++;
                    }
                } else {
                    params.currentFrameX ++;
                }
            }
        }

        // управление мышью
        function mouseMove(e) {
            player.y = e.pageY;
            player.x = e.pageX;
        }

        // управление клавиатурой
        function doKeyDown(e) {
            if(e.keyCode == 68) {
                player.x = player.x + 5;
            } else if(e.keyCode == 65) {
                player.x = player.x - 5;
            }
            if(e.keyCode == 87) {
                player.y = player.y - 5;
            } else if(e.keyCode == 83) {
                player.y = player.y + 5;
            }

            // запрет на выход за пределы экрана
            if(player.x < 0) {
                player.x = 0;
            } else if(player.x + player.width > gameCanvas.width) {
                player.x = gameCanvas.width - player.width;
            }
            if(player.y <0 ) {
                player.y = 0;
            } else if(player.y + player.height > gameCanvas.height) {
                player.y = gameCanvas.height - player.height;
            }
        }

        function PlayGame() {
            Drawing();
        }

        function Drawing() {
            gameCanvas.drawing();
            player.drawing();
            element1.drawing();
        }
    </script>
</head>

<body style="height: 100%" onload="Init()">
    <div style="height: 100%">
        <canvas id="namga-game"></canvas>
    </div>
</body>

</html>